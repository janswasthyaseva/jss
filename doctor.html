<!DOCTYPE html>
<html>
<head>
  <title>Doctor Desk â€“ Jan Swasthya Seva</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 20px;
    }
    .card {
      background: #fff;
      max-width: 700px;
      margin: auto;
      padding: 20px;
      border-radius: 8px;
    }
    h2 {
      text-align: center;
    }
    select, textarea, input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 14px;
    }
    textarea {
      min-height: 120px;
    }
    button {
      width: 100%;
      padding: 14px;
      margin-top: 15px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="card">
  <h2>Doctor Desk</h2>

  <select id="patient">
    <option value="">Select Patient</option>
  </select>

  <input id="doctor" placeholder="Doctor Name *">
  <input id="reg" placeholder="Registration Number *">

  <textarea id="note" placeholder="Clinical Notes *"></textarea>

  <button onclick="saveNote()">Save Note</button>
</div>

<script>
const BACKEND = "https://script.google.com/macros/s/AKfycbx_gAByhgJTy9k7KcS983n3vWpoeI2w-QTj0Uq9xZqaCNbWZsUeyX6UngNdL-5L6XJX/exec";
const hid = new URLSearchParams(window.location.search).get("hid");

/* Load patients */
fetch(BACKEND + "?action=ADMIN_PATIENTS&hospital_id=" + hid)
  .then(r => r.json())
  .then(list => {
    list.forEach(p => {
      if (p.status === "UNDER_TREATMENT") {
        const o = document.createElement("option");
        o.value = p.id;
        o.textContent = p.name + " (" + p.id + ")";
        document.getElementById("patient").appendChild(o);
      }
    });
  });

function saveNote() {
  const pid = document.getElementById("patient").value;
  const doctor = document.getElementById("doctor").value.trim();
  const reg = document.getElementById("reg").value.trim();
  const note = document.getElementById("note").value.trim();

  if (!pid || !doctor || !reg || !note) {
    alert("All fields are mandatory");
    return;
  }

  fetch(BACKEND, {
    method: "POST",
    body: JSON.stringify({
      action: "DOCTOR_NOTE",
      hospital_id: hid,
      system_patient_id: pid,
      clinical_note: note,
      clinician_name: doctor,
      clinician_registration: reg
    })
  })
  .then(r => r.json())
  .then(() => {
    alert("Note saved");
    document.getElementById("note").value = "";
  });
}
</script>

</body>
</html>
